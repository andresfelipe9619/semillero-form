<script>
  const adminAgreements = ["#becado", "#convenio_colegio"];

  function hideAdminData() {
    $("#modBusqueda").hide();
    showForm();
    hideAdminAgreements();
    hideInitialData();
  }

  function showSearchModule() {
    $("#modBusqueda").fadeIn();
    hideInitialData();
  }

  function hideAdminAgreements() {
    const agreements = adminAgreements.join(",");
    $(".radio-inline")
      .has(agreements)
      .hide();
    $(agreements).hide();
  }

  function hideInitialData() {
    hideFiles();
    hideModules();
  }

  const allowOnlyNumbers = e =>
    e.metaKey || // cmd/ctrl
    e.which <= 0 || // arrow keys
    e.which == 8 || // delete key
    /[0-9]/.test(String.fromCharCode(e.which)); // numbers

  const DoNotCopyPaste = e => e.preventDefault();

  function showFiles({ grade, estate }) {
    const isGraduated = grade === "EGRESADO";
    if (grade == 11 || isGraduated) {
      $("#myForm #modSemilleros").fadeIn();
      $("#myForm #pdfActaGrado").fadeOut();
    }
    if (isGraduated) showGraduateFiles();
    if (!isGraduated) {
      hideGraduateFiles();
      showStudyCertificate();
    }
    if (estate === "PRIVADO") hideStudyCertificate();
  }

  function showModules(grade) {
    if (!(grade in MODULES.byGrades) || !MODULES.byGrades) return;
    Object.keys(MODULES.byGrades[grade]).map(module => {
      const courses = MODULES.byGrades[grade][module];
      return showModuleCourses({ courses, module });
    });
  }

  function setModulesSelectionHTML(areas) {
    const modulesSelection = buildModulesSelection(areas);
    $(".modules_matricular").html(modulesSelection);
  }

  function buildModulesSelection(areas) {
    const columnsXrow = 3;
    let count = 1;
    let modulesSelection = Object.keys(areas).map(name => {
      const courses = areas[name];
      const coursesSelection = courses.map(({ nombre, codigo, area }, index) =>
        buildCourseSelection({ code: codigo, area, name: nombre })
      );
      const areaName = name.charAt(0).toUpperCase() + name.slice(1);
      let module = `
        <div id="mod${areaName}" class="col-xs-4 input-div">
          <div class="row">
            <h4>${areaName}</h4>
          </div>
          <div class="row input-div">
            ${coursesSelection.join("")}
          </div>
        </div>
      `;
      const isInitial = count === 1;
      const isLimit = count === columnsXrow;
      module = `${isInitial ? '<div class="row">' : ""}${module}${
        isLimit ? '</div>' : ""
      }`;
      count = isLimit ? 1 : ++count;
      return module;
    });
    modulesSelection = modulesSelection.join("");
    return modulesSelection;
  }

  function buildCourseSelection({ code, area, name }) {
    return ` <div id="tema${code}" class="checkbox">
       <input
         type="radio"
         class="${area}"
         name="seleccion"
         id="${code}"
         value="${code}"
       />
       <label>${name}</label>
     </div>`;
  }

  function showModuleCourses({ module, courses }) {
    const selector = `${moduleSelector(module)}`;
    $(`#myForm ${selector}`).fadeIn();
    $(`#myForm ${selector} .input-div`)
      .children()
      .fadeIn();
    if (!courses.length) return;
    const coursesSelector = courses
      .map(course => `#tema${course.codigo}`)
      .join(", ");
    $(`#myForm ${selector} .input-div`)
      .children()
      .not(coursesSelector)
      .hide();
  }

  function showCourse({ course, selector }) {
    const courseSelector = `#myForm ${selector} #${course.codigo}`;
    $(courseSelector).fadeIn();
  }

  function moduleSelector(module) {
    const selector = `#mod${module.charAt(0).toUpperCase()}${module.slice(1)}`;
    return selector;
  }

  function hideModules() {
    const hideArea = area => $(`#myForm ${moduleSelector(area)}`).hide();
    console.log("MODULES.byArea", MODULES.byArea);
    Object.keys(MODULES.byArea).map(hideArea);
  }

  function hideFiles() {
    $("#myForm #pdfConstanciaEstu").hide();
    $("#myForm #pdfContanciaFun").hide();
    $("#myForm #pdfRecibos").hide();
    $("#myForm #pdfCartaSolicitud").hide();
    $("#myForm #pdfActaGrado").hide();
  }

  function showScholarshipFiles() {
    $("#myForm #pdfRecibos").fadeIn();
    $("#myForm #pdfCartaSolicitud").fadeIn();
    $("#myForm #recibosPublicos").prop("disabled", false);
    $("#myForm #cartaSolicitud").prop("disabled", false);
    $("#myForm #pdfRecibo").fadeOut();
    $("#myForm #reciboFile").prop("disabled", true);
    hideStudyCertificate();
  }

  function hideScholarshipFiles() {
    $("#myForm #pdfRecibos").fadeOut();
    $("#myForm #pdfCartaSolicitud").fadeOut();
    $("#myForm #recibosPublicos").prop("disabled", true);
    $("#myForm #cartaSolicitud").prop("disabled", true);
  }

  function showUnivalleRelationFiles() {
    showStudyCertificate();
    $("#myForm #pdfRecibo").fadeIn();
    $("#myForm #reciboFile").prop("disabled", false);
    hideScholarshipFiles();
  }

  function showStudyCertificate() {
    $("#myForm #pdfConstanciaEstu").fadeIn();
    $("#myForm #constanciaEstudFile").prop("disabled", false);
  }

  function hideStudyCertificate() {
    $("#myForm #pdfConstanciaEstu").fadeOut();
    $("#myForm #constanciaEstudFile").prop("disabled", true);
  }

  function hideGraduateFiles() {
    $("#myForm #pdfActaGrado").fadeOut();
    $("#myForm #actaGrado").prop("disabled", true);
  }

  function showGraduateFiles() {
    $("#myForm #pdfActaGrado").fadeIn();
    $("#myForm #actaGrado").prop("disabled", false);
    hideStudyCertificate();
  }

  function hideStudentRecord() {
    cleanForm();
    $("#myForm").css("display", "none");
  }

  function showForm() {
    $("#myForm").css("display", "block");
    $("#myForm #save").css("display", "block");
  }

  function showStudentRecord() {
    cleanForm();
    showForm();
    $("#myForm #edit").css("display", "none");
  }

  function cleanForm(reload) {
    $(".numeric").val("");
    $(".text-uppercase").val("");
    $(".text-lowercase").val("");

    $(".file").val("");
    $("input:checkbox").removeAttr("checked");
    // $('#curso_anterior').empty('');
    reload && window.location.reload(true);
  }

  let departments = ["CAUCA", "VALLE DEL CAUCA"];
  let citiesData = [];
  citiesData[0] = "";
  citiesData[1] =
    "Popayán|Cajibío|El tambo|La Sierra|Morales|Piendamó|Rosas|Soatá|Timbío|Buenos aires|Caloto|Corintio|Guachené|Miranda|Padilla|Puerto Tejada|Santander de Quilichao|Suárez|Villa rica|Almaguer|Argelia|Balboa|Bolílet|Florencia|La vega|Mercaderes|Patía|Piamonte|San Sebastián|Santa Rosa|Sucre|Guapí|López de micay|Timbiquí|Caldono|Inzá|Jambaló|Páez|Puracé|Silvia|Toribío|Torotó";
  citiesData[2] =
    "|Cali|Candelaria|Dagua|Florida|Jamundí|La Cumbre|Palmira|Pradera|Vijes|Yumbo|Andalucía|Buga|Bugalagrande|Calima-El Darién|El Cerrito|Ginebra|Guacarí|Restrepo|Riofrío|San Pedro|Trujillo|Tuluá|Yotoco|Buenaventura|Caicedonia|Sevilla|Cartago|El águila|El Cairo|El Dovio|La Unión|La Victoria|Obando|Restrepo|Rodalnillo|Toro|Ulloa|Versalles|Zarzal|Alcalá";
  const departmentElementId = "depto_res";
  const cityElementId = "ciudad_res";
  const communeElementId = "comuna_res";
  function populateDepartments() {
    let countryElement = document.getElementById(departmentElementId);
    countryElement.length = 0;
    countryElement.options[0] = new Option("Seleccione Departamento", "-1");
    countryElement.selectedIndex = 0;
    for (let department of departments) {
      countryElement.options[countryElement.length] = new Option(
        department,
        department
      );
    }
    if (cityElementId) {
      countryElement.onchange = function() {
        populateCities();
      };
    }
  }

  function populateCities() {
    let selectedDepartment = document.getElementById(departmentElementId)
      .selectedIndex;

    let citieElement = document.getElementById(cityElementId);

    citieElement.length = 0;
    citieElement.options[0] = new Option("Seleccione Ciudad", "");
    citieElement.selectedIndex = 0;

    let cities = (citiesData[selectedDepartment] || []).split("|");

    for (let citie of cities) {
      citieElement.options[citieElement.length] = new Option(
        citie,
        citie.toUpperCase()
      );
    }
    if (communeElementId) {
      citieElement.onchange = function() {
        populateCommunes();
      };
    }
  }

  function populateCommunes() {
    let selectedCitie = document.getElementById(cityElementId).selectedIndex;
    if (selectedCitie !== 2) return $(`#div-comuna`).addClass("oculto");
    $(`#div-comuna`).removeClass("oculto");
    let communeElement = document.getElementById(communeElementId);

    communeElement.length = 0;
    communeElement.options[0] = new Option("Seleccione Comuna", "");
    communeElement.selectedIndex = 0;
    const communes = Array.from({ length: 21 }, (v, i) => ++i);
    for (let commune of communes) {
      communeElement.options[communeElement.length] = new Option(
        String(commune),
        String(commune)
      );
    }
  }

  function setWaitCursor() {
    $("#btn-buscar").css("cursor", "wait");
    $("body").css("cursor", "wait");
  }

  function setDefaultCursor() {
    $("#btn-buscar").css("cursor", "");
    $("body").css("cursor", "");
  }

  function cleanArray(actual) {
    let newArray = [];
    for (let i = 0, j = actual.length; i < j; i++) {
      if (actual[i] != "") {
        newArray.push(actual[i]);
      }
    }
    return newArray;
  }
</script>
